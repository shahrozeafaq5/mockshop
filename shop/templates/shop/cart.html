{% extends "shop/base.html" %}
{% block title %}Shopping Cart - Mock Shop{% endblock %}

{% block content %}
<div class="bg-white shadow rounded-2xl p-6">
  <h1 class="text-3xl font-bold mb-6">Your Cart</h1>

  {% if cart_items %}
    <div class="space-y-4">
      {% for item in cart_items %}
      <div class="flex flex-col md:flex-row items-center md:justify-between gap-4 border-b pb-4">
        <!-- Product -->
        <div class="flex items-center gap-4">
          {% if item.product.main_image %}
            <img src="{{ item.product.main_image.url }}" alt="{{ item.product.name }}" class="w-24 h-24 object-cover rounded-lg" />
          {% else %}
            <img src="https://via.placeholder.com/150x150?text=No+Image" class="w-24 h-24 object-cover rounded-lg" />
          {% endif %}
          <div>
            <h2 class="font-bold">{{ item.product.name }}</h2>
            <p class="text-gray-600">${{ item.product.price }}</p>
          </div>
        </div>

        <!-- Quantity -->
        <div x-data="{ qty: {{ item.quantity }} }" class="flex items-center gap-2">
          <form method="POST" action="{% url 'update_cart' item.product.id %}" class="flex items-center gap-2">
            {% csrf_token %}
            <button type="button" @click="qty = Math.max(1, qty - 1)" class="px-2 py-1 bg-gray-200 rounded">-</button>
            <input type="number" name="quantity" x-model.number="qty" min="1" class="w-16 text-center border rounded" />
            <button type="button" @click="qty = qty + 1" class="px-2 py-1 bg-gray-200 rounded">+</button>
            <button type="submit" class="ml-2 bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded">Update</button>
          </form>

          <form method="POST" action="{% url 'remove_from_cart' item.product.id %}">
            {% csrf_token %}
            <button type="submit" class="ml-2 bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded">Remove</button>
          </form>
        </div>

        <!-- Subtotal -->
        <div class="font-semibold text-lg">
          ${{ item.subtotal }}
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Total -->
    <div class="mt-6 flex justify-between items-center">
      <p class="text-2xl font-bold">Total: ${{ total }}</p>
      <a href="{% url 'checkout' %}" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg shadow">Proceed to Checkout â†’</a>
    </div>

  {% else %}
    <p class="text-gray-600">Your cart is empty. <a href="{% url 'product_list' %}" class="text-blue-600 hover:underline">Continue shopping</a></p>
  {% endif %}
</div>
{% endblock %}
